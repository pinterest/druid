{
  "type": "kafka",
  "dataSchema": {
    "dataSource": "ads_analytics_request_logs",
    "parser": {
      "type": "string",
      "parseSpec": {
        "format": "json",
        "timestampSpec": {
          "column": "requestReceivedTimestamp",
          "format": "auto"
        },
        "dimensionsSpec": {
          "dimensions": [
            "columns",
            "granularity",
            "childEntityType",
            "childEntityIds",
            "targetingTypes",
            "aggregateAcrossChildEntityIds",
            "viewWindowDays",
            "clickWindowDays",
            "engagementWindowDays",
            "conversionReportTimeType",
            "conversionTagVersion",
            "clientType",
            "requestSucceeded",
            "exceptionMessage",
            "requestType",
            "stageName",
            "traceId",
            "spanId",
            "parentSpanId",
            "filterColumns",
            "filterOperators",
            "objectIdEntityType",
            "ldap",            
            "druidRequestId",
            "traced",
            "requestB64Encoded",
            {
              "type": "long",
              "name": "advertiserId"
            },
            {
              "type": "long",
              "name": "userId"
            },
            {
              "type": "long",
              "name": "clientId"
            },
            {
              "type": "long",
              "name": "objectId"
            },
            {
              "type": "string",
              "name": "advertiserId_str"
            },
            {
              "type": "string",
              "name": "userId_str"
            },
            {
              "type": "string",
              "name": "objectId_str"
            },
            {
              "type": "long",
              "name": "startTime"
            },
            {
              "type": "long",
              "name": "endTime"
            }
          ],
          "dimensionExclusions": [
            "requestReceivedTimestamp"
          ]
        }
      }
    },
    "metricsSpec": [
      {
        "type" : "count",
        "name" : "count"
      },
      {
        "type" : "longSum",
        "name": "responseTime",
        "fieldName": "responseTime"
      },
      {
        "type" : "longSum",
        "name": "daysRequested",
        "fieldName": "daysRequested"
      },
      {
        "type" : "longSum",
        "name": "countColumnsRequested",
        "fieldName": "countColumnsRequested"
      },
      {
        "type" : "longSum",
        "name": "countChildEntityIdsRequested",
        "fieldName": "countChildEntityIdsRequested"
      },
      {
        "type": "longSum",
        "name": "druidResponseTime",
        "fieldName": "druidResponseTime"
      },
      {
        "type": "longSum",
        "name": "rowsReturned",
        "fieldName": "rowsReturned"
      },
      {
        "type" : "longSum",
        "name": "countFilters",
        "fieldName": "countFilters"
      }
    ],
    "transformSpec": {
      "transforms": [
        {
          "type": "expression",
          "name": "advertiserId",
          "expression": "cast(advertiserId, 'long')"
        },
        {
          "type": "expression",
          "name": "userId",
          "expression": "cast(userId, 'long')"
        },
        {
          "type": "expression",
          "name": "objectId",
          "expression": "cast(objectId, 'long')"
        },
        {
          "type": "expression",
          "name": "advertiserId_str",
          "expression": "cast(advertiserId, 'string')"
        },
        {
          "type": "expression",
          "name": "userId_str",
          "expression": "cast(userId, 'string')"
        },
        {
          "type": "expression",
          "name": "objectId_str",
          "expression": "cast(objectId, 'string')"
        },
        {
          "type": "expression",
          "name": "startTimeLong",
          "expression": "cast(startTime, 'long')"
        },
        {
          "type": "expression",
          "name": "endTimeLong",
          "expression": "cast(endTime, 'long')"
        }
      ]
    },
    "granularitySpec": {
      "type": "uniform",
      "segmentGranularity": "HOUR",
      "queryGranularity": "NONE"
    }
  },
  "tuningConfig": {
    "type": "kafka",
    "maxRowsPerSegment": 5000000,
    "resetOffsetAutomatically": "true"
  },
  "ioConfig": {
    "topic": "ads_analytics_request_log",
    "consumerProperties": {
      "bootstrap.servers": {
        "type": "serverset",
        "file": "/var/serverset/discovery.m10nkafka.prod"
      }
    },
    "taskCount": 5,
    "replicas": 1,
    "taskDuration": "PT45M",
    "useEarliestOffset": "true"
  }
}
